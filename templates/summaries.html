<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Summaries</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            margin-top: 56px;
            background-color: #f8f9fa;
        }
        .read-button i, .stop-button i, .bookmark-button i {
            color: #ffffff;
        }
        .read-button i, .bookmark-button i {
            color: #000000;
        }
    </style>
</head>

<body>
    {% include 'navbar.html' %}

    <div class="container mt-5 pt-3">
        <h1 class="mb-4">{{ search }} 검색 결과</h1>
        {% for item in summaries %}
        <div class="card mb-4">
            <div class="card-body">
                <h2 class="card-title">{{ item['title'] }}</h2>
                <p class="card-text">{{ item['summary'] }}</p>
                <div class="d-flex align-items-center">
                    <a href="{{ item['link'] }}" class="btn btn-primary me-2" target="_blank">원문 보기</a>
                    <button class="read-button btn btn-secondary me-2" data-summary="{{ item['summary'] }}" data-rate="{{ item['rate'] }}">
                        <i class="fas fa-circle-play fa-2x"></i>
                    </button>
                    <button class="bookmark-button btn btn-warning" data-title="{{ item['title'] }}" data-summary="{{ item['summary'] }}" data-link="{{ item['link'] }}">
                        <i class="fas fa-bookmark fa-2x"></i>
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- 푸터 포함 -->
    {% include 'footer.html' %}

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
    <script>
        let isPlaying = false;
        let utterance = new SpeechSynthesisUtterance();
        utterance.lang = 'ko-KR';

        document.querySelectorAll('.read-button').forEach(function(button) {
            button.addEventListener('click', function() {
                var summary = this.getAttribute('data-summary');
                var rate = parseFloat(this.getAttribute('data-rate')) || 2;
                if (!isPlaying) {
                    utterance.text = summary;
                    utterance.rate = rate;
                    speechSynthesis.speak(utterance);
                    isPlaying = true;
                    button.innerHTML = '<i class="fas fa-stop fa-2x"></i>';
                    utterance.onend = function() {
                        button.innerHTML = '<i class="fas fa-circle-play fa-2x"></i>';
                        isPlaying = false;
                    };
                } else {
                    speechSynthesis.cancel();
                    isPlaying = false;
                    button.innerHTML = '<i class="fas fa-circle-play fa-2x"></i>';
                }
            });
        });

        document.querySelectorAll('.bookmark-button').forEach(function(button) {
            button.addEventListener('click', function() {
                var title = this.getAttribute('data-title');
                var summary = this.getAttribute('data-summary');
                var link = this.getAttribute('data-link');

                fetch('/bookmark', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ title: title, summary: summary, link: link })
                }).then(response => {
                    if (response.ok) {
                        alert('즐겨찾기에 추가되었습니다.');
                    } else {
                        alert('즐겨찾기 추가에 실패했습니다.');
                    }
                });
            });
        });
    </script>
</body>

</html>
